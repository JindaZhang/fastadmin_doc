

    <div class="content with-sidebar">
        <h1 data-id="177" data-eid="V4v5">
        文件上传    </h1>
    
    <p><code>FastAdmin</code>开发框架支持将文件、图片、视频、压缩包等文件快速的上传至本地服务器或云存储，同时支持云存储直传模式和服务器进行中转模式。<br>你可以直接在后台<code>插件管理</code>安装第三方云存储的插件后使用，目前支持以下云存储平台：</p><table><thead><tr><th>平台</th><th>特点</th><th>插件下载</th></tr></thead><tbody><tr><td>又拍云存储</td><td>申请加入又拍云联盟可享每月10G存储空间+15G流量</td><td><a  href="https://www.fastadmin.net/store/upyun.html"  target="_blank">下载</a></td></tr><tr><td>七牛云存储</td><td>实名认证后每月免费10G流量+10GCDN回源流量</td><td><a  href="https://www.fastadmin.net/store/qiniu.html"  target="_blank">下载</a></td></tr><tr><td>阿里OSS云存储</td><td>阿里系、稳定、图片处理、支持挂载为分区</td><td><a  href="https://www.fastadmin.net/store/alioss.html"  target="_blank">下载</a></td></tr><tr><td>Ucloud云存储</td><td>数据安全可靠、成本灵活可控的海量文件存储服务</td><td><a  href="https://www.fastadmin.net/store/ucloud.html"  target="_blank">下载</a></td></tr><tr><td>腾讯COS云存储</td><td>认证个人用户50G标准存储(6个月)，认证企业用户1T标准存储(6个月)</td><td><a  href="https://www.fastadmin.net/store/cos.html"  target="_blank">下载</a></td></tr><tr><td>百度BOS云存储</td><td>提供稳定、安全、高效、高可扩展的云存储服务</td><td><a  href="https://www.fastadmin.net/store/bos.html"  target="_blank">下载</a></td></tr><tr><td>华为OBS云存储</td><td>提供海量、安全、高可靠、低成本的数据存储能力</td><td><a  href="https://www.fastadmin.net/store/hwobs.html"  target="_blank">下载</a></td></tr></tbody></table><div class="custom-block github-alert tip"><p class="custom-block-title">温馨提示</p><p>从FastAdmin 1.2.0版本开始，所有云存储均已适配分片上传功能<br>FastAdmin只支持启用一个云存储插件，请勿同时启用多个云存储插件</p></div><p>FastAdmin开发框架的上传功能非常强大，我们只需要简单的配置即可支持单图或多图上传。</p><h2 id="上传配置-1">上传配置</h2><p>如果我们未启用云存储插件，此时上传读取的是<code>application/extra/upload.php</code>这个配置文件。</p><table><thead><tr><th>配置名称</th><th>配置值</th><th>说明</th></tr></thead><tbody><tr><td>uploadurl</td><td>ajax/upload</td><td>一般情况下无需修改</td></tr><tr><td>cdnurl</td><td>空</td><td>一般情况下为空，如果你的应用不限于PC端，可以填写你的网站地址，如<a href="https://www.fastadmin.net/outlink.html?url=https%3A%2F%2Fwww.example.com" target="_blank" rel="nofollow">https://www.example.com</a></td></tr><tr><td>savekey</td><td>/uploads/{year}{mon}{day}/{filemd5}{.suffix}</td><td>配置文件保存的路径</td></tr><tr><td>maxsize</td><td>10mb</td><td>最大可上传的文件大小，如果启用分片上传，这个值则是限制单一分片的最大值</td></tr><tr><td>maxcount</td><td>0</td><td>最大可上传的文件数量，仅对多文件上传有效，为0时表示不限制</td></tr><tr><td>mimetype</td><td>jpg,png,bmp,jpeg,gif,zip,rar,xls,xlsx</td><td>允许上传的后缀列表，支持Mimetype，如<code>jpg,png,image/bmp,application/zip</code></td></tr><tr><td>timeout</td><td>30000</td><td>默认上传超时时长为30000，表示30秒</td></tr><tr><td>multiple</td><td>false</td><td>是否默认启用多文件上传，默认关闭，一般在HTML中配置<code>data-multiple=&quot;true&quot;</code></td></tr><tr><td>chunking</td><td>false</td><td>是否允许使用分片上传，默认关闭，如需启用需配合HTML中的配置，参考下方的分片上传</td></tr><tr><td>chunksize</td><td>2097152</td><td>分片的大小，默认为<code>2MB</code>，建议整数</td></tr><tr><td>fullmode</td><td>false</td><td>是否启用完整URL路路径模式，默认关闭，只支持<code>FastAdmin1.3.3+</code></td></tr></tbody></table><div class="custom-block github-alert tip"><p class="custom-block-title">温馨提示</p><p>如果安装了云存储插件并启用，则相关配置请在后台插件管理，对应的云存储配置中进行设置。<br>如果安装了云存储插件并启用，则所有的文件都将上传至云存储，如果需要上传到本地服务器，请给按钮添加<code>data-url=&quot;ajax/upload&quot;</code>属性<br>不支持同时启用多个云存储插件，只允许启用一个云存储插件</p></div><h3 id="文件名规则-1">文件名规则</h3><p>文件保存文件名<code>savekey</code>支持替换的变量如下：</p><table><thead><tr><th>变量</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>{year}</td><td>获取当前上传的年份,以上传获取配置的时间为基准</td><td>2024</td></tr><tr><td>{mon}</td><td>获取当前上传的月份,以上传获取配置的时间为基准</td><td>10</td></tr><tr><td>{day}</td><td>获取当前上传的日期,以上传获取配置的时间为基准</td><td>08</td></tr><tr><td>{hour}</td><td>获取当前上传的小时,以上传获取配置的时间为基准</td><td>12</td></tr><tr><td>{min}</td><td>获取当前上传的分钟,以上传获取配置的时间为基准</td><td>43</td></tr><tr><td>{sec}</td><td>获取当前上传的秒,以上传获取配置的时间为基准</td><td>36</td></tr><tr><td>{random}</td><td>16位随机数</td><td>38dj38h92jf0sjf5</td></tr><tr><td>{random32}</td><td>32位随机数</td><td>jf0sjf0sjf538dj38h92jf538dj38h92</td></tr><tr><td>{filename}</td><td>文件名</td><td><code>abcd.jpg</code> (<code>FastAdmin 1.3.0+</code>支持) 文件名含后缀</td></tr><tr><td>{suffix}</td><td>文件后缀名,如果上传文件无后缀则为<code>file</code></td><td><code>jpg</code></td></tr><tr><td>{.suffix}</td><td>带<code>.</code>的文件后缀名,如果上传文件无后缀则为<code>.file</code></td><td><code>.jpg</code></td></tr><tr><td>{filemd5}</td><td>上传文件的MD5值，上传超大文件时可能导致前端MD5计算耗时过长</td><td>sjf538dj0f53h9238h92jjf08dj38sjf</td></tr></tbody></table><div class="custom-block github-alert tip"><p class="custom-block-title">温馨提示</p><p>如在<code>savekey</code>中使用了<code>{filemd5}</code>，上传超大文件时可能导致前端MD5计算耗时过长</p></div><h3 id="上传示例-2">上传示例</h3><pre title=""><code class="language-html">&lt;div class=&quot;form-group&quot;&gt;
    &lt;label for=&quot;c-avatar&quot; class=&quot;control-label col-xs-12 col-sm-2&quot;&gt;头像:&lt;/label&gt;
    &lt;div class=&quot;col-xs-12 col-sm-8&quot;&gt;
        &lt;div class=&quot;input-group&quot;&gt;
            &lt;input id=&quot;c-avatar&quot; data-rule=&quot;&quot; class=&quot;form-control&quot; size=&quot;50&quot; name=&quot;row[avatar]&quot; type=&quot;text&quot; value=&quot;{$row.avatar}&quot;&gt;
            &lt;div class=&quot;input-group-addon no-border no-padding&quot;&gt;
                &lt;span&gt;&lt;button type=&quot;button&quot; id=&quot;faupload-avatar&quot; class=&quot;btn btn-danger faupload&quot; data-input-id=&quot;c-avatar&quot; data-mimetype=&quot;image/gif,image/jpeg,image/png,image/jpg,image/bmp&quot; data-multiple=&quot;false&quot; data-preview-id=&quot;p-avatar&quot;&gt;&lt;i class=&quot;fa fa-upload&quot;&gt;&lt;/i&gt; 上传&lt;/button&gt;&lt;/span&gt;
                &lt;span&gt;&lt;button type=&quot;button&quot; id=&quot;fachoose-avatar&quot; class=&quot;btn btn-primary fachoose&quot; data-input-id=&quot;c-avatar&quot; data-mimetype=&quot;image/*&quot; data-multiple=&quot;false&quot;&gt;&lt;i class=&quot;fa fa-list&quot;&gt;&lt;/i&gt; 选择&lt;/button&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;span class=&quot;msg-box n-right&quot; for=&quot;c-avatar&quot;&gt;&lt;/span&gt;
        &lt;/div&gt;
        &lt;ul class=&quot;row list-inline faupload-preview&quot; id=&quot;p-avatar&quot;&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre><p>我们可以看到这里配置了一个文本框、一个上传按钮、一个选择按钮和一个预览的DIV</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>文本框</td><td>主要用于接收上传后返回的图片链接，文本框<code>id</code>属性是必选的，这里的<code>id</code>是<code>c-avatar</code></td></tr><tr><td>上传按钮</td><td>主要用于点击后上传文件，有几个属性非常重要，请参考下方的上传按钮属性介绍</td></tr><tr><td>选择按钮</td><td>主要用于点击后选择已经上传的文件，有几个属性非常重要，请参考下方的选择按钮属性介绍</td></tr><tr><td>预览区域</td><td>主要用于预览上传或选择文件后的预览。<code>id</code>属性是必选的，这里的<code>id</code>是<code>p-avatar</code></td></tr></tbody></table><h3 id="按钮属性-3">按钮属性</h3><p>上传按钮支持属性</p><table><thead><tr><th>属性</th><th>示例值</th><th>说明</th></tr></thead><tbody><tr><td>data-url</td><td>ajax/upload</td><td>用于配置上传文件接收的地址，当配置为<code>ajax/upload</code>表示启用本地上传</td></tr><tr><td>data-multipart</td><td>{"key1":"value1"}</td><td>用于上传时附加额外的参数信息</td></tr><tr><td>data-input-id</td><td>c-avatar</td><td>用于填充返回URL地址的设文本框</td></tr><tr><td>data-mimetype</td><td>image/gif,image/jpeg,image/png,image/jpg,image/bmp</td><td>用于过滤允许上传的文件类型，支持mimetype或文件后缀名</td></tr><tr><td>data-multiple</td><td>false</td><td>是否支持多图或多文件模式</td></tr><tr><td>data-preview-id</td><td>p-avatar</td><td>用于预览返回URL地址的DIV</td></tr><tr><td>data-maxsize</td><td>10M</td><td>用于限制最大可上传的文件大小</td></tr><tr><td>data-maxcount</td><td>1</td><td>用于限制最大可上传的文件数量</td></tr><tr><td>data-timeout</td><td>60000</td><td>用于设定上传超时时长，<code>60000</code>表示<code>60</code>秒，默认为<code>30000</code>，表示<code>30</code>秒</td></tr><tr><td>data-chunking</td><td>true</td><td>是否启用分片上传,<code>1.2.0</code>版本新增</td></tr><tr><td>data-chunk-size</td><td>2097152</td><td>分片单片文件大小,<code>1.2.0</code>版本新增</td></tr><tr><td>data-resize-quality</td><td>0.8</td><td>默认不压缩，只有当设置<code>resizeWidth</code>或<code>resizeHeight</code>时才压缩，设置上传图片的压缩品质,<code>1.2.0</code>版本新增</td></tr><tr><td>data-resize-width</td><td>1024</td><td>默认为<code>null</code>不剪裁，上传前剪裁图片宽度,<code>1.2.0</code>版本新增</td></tr><tr><td>data-resize-height</td><td>768</td><td>默认为<code>null</code>不剪裁，上传前剪裁图片高度,<code>1.2.0</code>版本新增</td></tr></tbody></table><p>选择按钮支持属性</p><table><thead><tr><th>属性</th><th>示例值</th><th>说明</th></tr></thead><tbody><tr><td>data-input-id</td><td>c-avatar</td><td>用于填充返回URL地址的设文本框</td></tr><tr><td>data-mimetype</td><td>image/gif,image/jpeg,image/png,image/jpg,image/bmp</td><td>用于过滤允许上传的文件类型，支持mimetype或文件后缀名</td></tr><tr><td>data-multiple</td><td>false</td><td>是否支持多图或多文件模式</td></tr><tr><td>data-preview-id</td><td>p-avatar</td><td>用于预览返回URL地址的DIV</td></tr></tbody></table><h3 id="上传按钮事件-4">上传按钮事件</h3><table><thead><tr><th>属性</th><th>示例值</th><th>说明</th></tr></thead><tbody><tr><td>data-upload-success</td><td>function</td><td>上传成功后会进行回调，需使用<code>$(&quot;按钮&quot;).data(&quot;upload-success&quot;, function(data, ret, up, file){});</code>赋值</td></tr><tr><td>data-upload-error</td><td>function</td><td>上传失败后会进行回调，需使用<code>$(&quot;按钮&quot;).data(&quot;upload-error&quot;, function(data, ret, up, file){});</code>赋值</td></tr><tr><td>data-totaluploadprogress</td><td>function</td><td>上传进度的回调，需使用<code>$(&quot;按钮&quot;).data(&quot;totaluploadprogress&quot;, function(progress, bytesSent){});</code>赋值</td></tr></tbody></table><h2 id="直接上传-2">直接上传</h2><p>如果我们想直接通过JS上传一个文件到我们的服务器(支持云存储插件)，我们可以使用</p><pre title=""><code>Upload.api.send(file, function(data, ret, up, file){
    // 上传成功的回调
}, function(data, ret, up, file){
    // 上传失败的回调
});</code></pre><p>来上传文件。</p><h2 id="分片上传-3">分片上传</h2><p>从FastAdmin <code>1.2.0</code>版本开始已经支持分片上传，如果需要启用分片上传，必须客户端和服务端同时开启。首先找到<code>application/extra/upload.php</code>，修改其中的<code>chunking</code>值为<code>true</code>。<br>其次给按钮添加<code>data-chunking=true</code>属性即可，如果提示文件过大，可以再添加<code>data-maxsize=&quot;1024M&quot;</code>来控制允许上传的文件大小。</p><div class="custom-block github-alert tip"><p class="custom-block-title">温馨提示</p><p>1、因为<code>FastAdmin</code> 框架不支持断点续传，如果采用分片上传大文件时，如果受网络波动影响，有其中一片上传错误，会导致整个文件上传失败，建议使用第三方工具进行上传超大文件。<br>2、分片上传不支持富文本编辑器内的上传。</p></div><h2 id="上传成功后归类-4">上传成功后归类</h2><p>从FastAdmin <code>1.2.1</code>版本开始已经支持上传成功后归类功能，我们可以通过给上传按钮添加<code>data-params='{&quot;category&quot;:&quot;category2&quot;}'</code>来实现，这个即是上传归类到<code>category2</code>，这个<code>category2</code>可以在<code>常规管理</code>-&gt;<code>系统配置</code>-&gt;<code>字典配置</code>中添加修改</p><h2 id="自定义上传预览-5">自定义上传预览</h2><p>FastAdmin中的上传组件，默认只支持预览图片预览，当判断到不是图片时会使用对应的文件后缀进行预览，如果需要使用自定义上传预览，可以参考以下方法进行实现。<br>首先请参考上方的上传示例代码，我们给预览区域<code>&lt;ul class=&quot;row list-inline faupload-preview&quot; id=&quot;p-avatar&quot;&gt;&lt;/ul&gt;</code>添加一个<code>data-template</code>的属性</p><pre title=""><code>&lt;ul class=&quot;row list-inline faupload-preview&quot; id=&quot;p-avatar&quot; data-template=&quot;avatartpl&quot;&gt;&lt;/ul&gt;</code></pre><p>然后在页面底部添加一个<code>avatartpl</code>的自定义模板，如：</p><pre title=""><code>&lt;script type=&quot;text/html&quot; id=&quot;avatartpl&quot;&gt;
    &lt;li class=&quot;col-xs-3&quot;&gt;
        &lt;a href=&quot;&lt;%=fullurl%&gt;&quot; data-url=&quot;&lt;%=url%&gt;&quot; target=&quot;_blank&quot; class=&quot;thumbnail&quot;&gt;
            &lt;img src=&quot;&lt;%=fullurl%&gt;&quot; class=&quot;img-responsive&quot;&gt;
        &lt;/a&gt;
        &lt;a href=&quot;javascript:;&quot; class=&quot;btn btn-danger btn-xs btn-trash&quot;&gt;&lt;i class=&quot;fa fa-trash&quot;&gt;&lt;/i&gt;&lt;/a&gt;
    &lt;/li&gt;
&lt;/script&gt;</code></pre><p>这其中的<code>data-template</code>的值对应我们自定义模板ID的值，自定义模板中支持的变量如下：</p><table><thead><tr><th>变量名</th><th>描述</th></tr></thead><tbody><tr><td>fullurl</td><td>完整的资源路径</td></tr><tr><td>url</td><td>相对的资源路径，当启用<code>fullmode</code>时为完整的资源路径</td></tr><tr><td>index</td><td>多个资源时，当前资源所在位置的索引</td></tr></tbody></table><h2 id="大文件上传-6">大文件上传</h2><p>当我们在大文件上传时，除了可以采用上方的<code>分片上传</code>以外，还可以通过修改服务器的配置来实现大文件上传。大文件上传时通常涉及到<code>插件配置/本地配置/PHP配置/Nginx配置</code>四处地方需要修改。<br>1、如果有安装云存储插件，首先请在后台<code>插件管理</code>修改云存储插件-&gt;<code>配置</code>中的<code>最大可上传</code>配置值。<br>2、然后修改 <code>application/extra/upload.php</code> 里的 <code>maxsize</code>的值。<br>3、接着修改<code>PHP</code>上传限制，修改你服务器运行环境的 <code>php.ini</code> 里的 <code>max_execution_time=300</code>、<code>upload_max_filesize=100M</code>、<code>post_max_size=100M</code>三个配置值。<br>4、如果使用<code>Nginx</code> 还需要修改<code>Nginx</code>的配置<code>client_max_body_size 100M;</code><br>5、修改配置后务必重启Web服务和清浏览器缓存。</p><blockquote>宝塔面板修改请参考：<a href="https://ask.fastadmin.net/question/30109.html" target="_blank" >https://ask.fastadmin.net/question/30109.html</a></blockquote><h2 id="自定义上传-7">自定义上传</h2><p>请参考文档：<a href="https://doc.fastadmin.net/doc/frontend.html#toc-6" target="_blank" >https://doc.fastadmin.net/doc/frontend.html#toc-6</a></p><h2 id="温馨提示-8">温馨提示</h2><p>1、如果是动态生成的上传按钮，需要使用<code>Form.events.faupload(表单);</code>绑定事件<br>2、即使设置了分片上传，也只有当上传的文件超过设置的单一分片文件大小时才会启用分片上传。<br>3、从<code>1.2.0</code>开始，前端上传默认超时为<code>30</code>秒，如上传大文件，请给上传按钮添加<code>data-timeout=&quot;600000&quot;</code>设定为10分钟超时。<br>4、如果安装了云存储插件，上传没有生效，请尝试清空浏览器缓存。<br>5、如果遇到上传大文件失败，请参考<a href="https://ask.fastadmin.net/question/26919.html" target="_blank" >https://ask.fastadmin.net/question/26919.html</a> 进行修改服务器的限制。<br>6、如果安装了云存储插件并启用，则所有的文件都将上传至云存储，如果仍需要上传文件到本地服务器，请给按钮添加<code>data-url=&quot;ajax/upload&quot;</code>属性<br>7、由于<code>FastAdmin</code>中多图(多文件)使用<code>,</code>作为分隔符处理，因此不支持单个文件(图片)URL中使用<code>,</code>，这种情况常见于云存储图片自定义处理，建议云存储图片处理时采用自定义样式来避免使用到<code>,</code>的情况。</p>
    <div class="date text-muted" style="margin-top:10px;">文档最后更新时间：2024-09-19 14:31:57</div>
    <div class="copyrights text-muted" style="margin-top:10px;">著作权归应用插件开发者所有，未经许可，禁止转载、复制此文档的任何内容。</div>

        <div class="docs-links">
        <!--@formatter:off-->
                    <span>← <a href="https://doc.fastadmin.net/doc/component.html" data-id="156">组件</a></span>
                        <span style="float:right"><a href="https://doc.fastadmin.net/doc/178.html" data-id="178">动态下拉(SelectPage)</a> →</span>
                    <!--@formatter:on-->
    </div>
    
    